#!/usr/bin/env php
<?php

use CodeIgniter\Boot;
use Config\Paths;

// Path to the front controller (this file)
define('FCPATH', __DIR__ . DIRECTORY_SEPARATOR);

// Ensure the current directory is pointing to the front controller's directory
if (getcwd() . DIRECTORY_SEPARATOR !== FCPATH) {
    chdir(FCPATH);
}

require FCPATH . 'app/Config/Paths.php';

$rootPath = dirname(__DIR__) . DIRECTORY_SEPARATOR;
if (basename(__DIR__) !== 'public') {
    $rootPath = __DIR__ . DIRECTORY_SEPARATOR;
}

defined('ROOTPATH') || define('ROOTPATH', $rootPath);
defined('VENDORPATH') || define('VENDORPATH', ROOTPATH . 'vendor' . DIRECTORY_SEPARATOR);
defined('COMPOSER_PATH') || define('COMPOSER_PATH', VENDORPATH . 'composer' . DIRECTORY_SEPARATOR);

$paths = new Paths();

$bootFile = rtrim($paths->systemDirectory, '/\\') . '/Boot.php';
if (! is_file($bootFile)) {
    fwrite(STDERR, "Dependencies missing or incomplete. Run: composer install\n");
    exit(1);
}

// LOAD THE FRAMEWORK BOOTSTRAP FILE
require $bootFile;

exit(Boot::bootSpark($paths));
